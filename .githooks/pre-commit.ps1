# Auto-update src/version.js with short readable version (YYMMDD-##)
$ErrorActionPreference = "Stop"

$root = git rev-parse --show-toplevel
$versionFile = Join-Path $root "src\version.js"

# Get today's date in YYMMDD format
$datePart = (Get-Date).ToString("yyMMdd")

# Get number of commits already today
$commitCountToday = (git log --oneline --since="$($datePart.Substring(0,2))-$($datePart.Substring(2,2))-$($datePart.Substring(4,2))" --until=tomorrow | Measure-Object).Count

# Increment by 1 for this commit
$buildNum = "{0:D2}" -f ($commitCountToday + 1)

# Combine into final version string
$ver = "$datePart-$buildNum"

$js = @"
// this file is auto-generated by .githooks/pre-commit.ps1
export const BUILD_VERSION = '$ver';
"@

Set-Content -Path $versionFile -Value $js -NoNewline -Encoding UTF8
git add "src/version.js"
